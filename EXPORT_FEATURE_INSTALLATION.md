# 测试用例导出功能 - 安装和使用指南

## 📦 安装依赖

### 1. 安装 npm 包

在项目根目录执行以下命令：

```bash
npm install
```

这将自动安装所需的依赖包：
- `xlsx@0.18.5` - Excel文件处理库
- `file-saver@2.0.5` - 文件下载库

### 2. 验证安装

检查 `package.json` 中是否已包含以下依赖：

```json
{
  "dependencies": {
    "file-saver": "^2.0.5",
    "xlsx": "^0.18.5"
  }
}
```

---

## 🚀 快速开始

### 使用方式

1. 打开任意测试用例详情页面
2. 点击顶部的"更多"按钮
3. 选择"导出用例"
4. 在弹出的对话框中配置导出选项
5. 点击"开始导出"按钮
6. 文件将自动下载到本地

---

## 🎨 功能特性

### 支持的导出格式

| 格式 | 扩展名 | 适用场景 | 优势 |
|------|--------|----------|------|
| Excel | `.xlsx` | 查看和编辑 | ✅ 推荐，支持多工作表、格式化 |
| JSON | `.json` | 程序处理 | 结构化数据，易于解析 |
| YAML | `.yaml` | 配置管理 | 人类可读，适合版本控制 |
| CSV | `.csv` | 表格处理 | 简单通用，Excel兼容 |

### 导出选项

#### 必选内容
- ✅ **基本信息**（始终包含）
  - 用例编码、名称、描述
  - 优先级、严重程度
  - 标签、版本号
  - 关联接口信息
  - 创建人和时间

#### 可选内容
- □ **测试步骤** - 详细的操作步骤和预期结果
- □ **断言规则** - JSON路径、状态码等验证规则
- □ **提取规则** - 响应数据提取配置
- □ **执行历史** - 最近的测试执行记录

#### 高级选项
- **自定义文件名** - 自定义导出文件名称
- **编码格式**（CSV专用）- UTF-8 或 GBK（中文Excel兼容）

---

## 📊 导出文件示例

### Excel 格式

**文件结构：**
```
TC_AUTH001_001_2025-10-23T16-30-45.xlsx
├── Sheet1: 基本信息
├── Sheet2: 测试步骤 (可选)
├── Sheet3: 断言规则 (可选)
├── Sheet4: 提取规则 (可选)
└── Sheet5: 执行历史 (可选)
```

**Sheet1 - 基本信息：**
| 字段 | 值 |
|------|-----|
| 用例编码 | TC_AUTH001_001 |
| 用例名称 | 正常登录测试 |
| 用例描述 | 测试用户正常登录流程 |
| 优先级 | P0 |
| ... | ... |

**Sheet2 - 测试步骤：**
| 步骤序号 | 操作步骤 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| 1 | 打开登录页面 | 页面正常显示 | |
| 2 | 输入用户名和密码 | 输入框正常接收 | |
| 3 | 点击登录按钮 | 登录成功 | |

### JSON 格式

```json
{
  "caseCode": "TC_AUTH001_001",
  "caseName": "正常登录测试",
  "description": "测试用户正常登录流程",
  "priority": "P0",
  "severity": "high",
  "tags": ["登录", "认证"],
  "version": "1.0",
  "isEnabled": true,
  "apiInfo": {
    "apiId": 10,
    "apiName": "用户登录接口",
    "apiPath": "/api/auth/login",
    "apiMethod": "POST"
  },
  "testSteps": [
    {
      "operation": "打开登录页面",
      "expected": "页面正常显示"
    }
  ],
  "assertions": [...],
  "extractors": [...]
}
```

### YAML 格式

```yaml
# 测试用例导出
# 导出时间: 2025-10-23 16:30:45

# ==================== 基本信息 ====================
caseCode: TC_AUTH001_001
caseName: 正常登录测试
description: |
  测试用户正常登录流程
priority: P0
severity: high
tags:
  - 登录
  - 认证

# ==================== 测试步骤 ====================
testSteps:
  - step: 1
    operation: 打开登录页面
    expected: 页面正常显示
```

### CSV 格式

```csv
"字段","值"
"用例编码","TC_AUTH001_001"
"用例名称","正常登录测试"
"用例描述","测试用户正常登录流程"
"优先级","P0"
"严重程度","high"
```

---

## 🔧 技术实现

### 前端本地导出

当前实现使用纯前端导出，不依赖后端接口：

**优势：**
- ✅ 无需等待后端开发
- ✅ 响应速度快
- ✅ 减轻服务器负担
- ✅ 支持离线使用

**核心库：**
- `xlsx` - 处理Excel文件生成
- `file-saver` - 处理文件下载

**实现文件：**
- `src/utils/exportTestCase.js` - 导出工具类
- `src/components/cases/CaseDetail.vue` - UI组件

### 数据字段映射

前端会自动处理驼峰命名和下划线命名的兼容：

```javascript
// 自动兼容两种命名方式
const caseCode = testCase.caseCode || testCase.case_code
const apiName = testCase.apiName || testCase.api_name
```

---

## 🎯 使用场景

### 场景1：导出用于文档

**需求：** 将测试用例导出为Word或PDF文档

**步骤：**
1. 选择 Excel 格式导出
2. 在Excel中编辑和格式化
3. 另存为PDF或复制到Word

### 场景2：导出用于备份

**需求：** 定期备份测试用例数据

**步骤：**
1. 选择 JSON 格式导出
2. JSON格式完整保存所有数据
3. 便于版本控制和对比

### 场景3：导出用于迁移

**需求：** 将测试用例迁移到其他系统

**步骤：**
1. 选择 YAML 或 JSON 格式
2. 其他系统可以解析这些标准格式
3. 批量导入到目标系统

### 场景4：导出用于分析

**需求：** 使用Excel进行数据分析

**步骤：**
1. 选择 Excel 格式导出
2. 利用Excel的数据透视表功能
3. 分析测试用例分布和覆盖率

---

## ⚠️ 注意事项

### 浏览器兼容性

✅ **支持的浏览器：**
- Chrome 90+
- Firefox 88+
- Edge 90+
- Safari 14+

❌ **不支持：**
- IE 11 及更早版本

### 文件大小限制

- 单个用例导出：通常 < 1MB
- 包含执行历史：可能达到 5-10MB
- Excel格式会比JSON/YAML大 20-50%

### 性能考虑

- 导出速度：通常 < 1秒
- 大量数据时可能需要 2-3秒
- 不会阻塞页面操作

---

## 🐛 常见问题

### Q1: 导出的Excel文件打不开？

**A:** 确保使用 Microsoft Excel 2007+ 或 WPS Office。如果仍然无法打开：
1. 检查文件扩展名是否为 `.xlsx`
2. 尝试重新导出
3. 更新Excel或使用其他工具（如Google Sheets）

### Q2: CSV文件中文乱码？

**A:** 选择 GBK 编码格式：
1. 在导出对话框中
2. 选择"编码格式" = "GBK（中文Excel兼容）"
3. 重新导出

### Q3: 导出的JSON格式不正确？

**A:** 
1. 使用JSON验证工具检查
2. 确保测试用例数据完整
3. 检查浏览器控制台是否有错误信息

### Q4: 文件名称乱码？

**A:** 
1. 使用英文或数字自定义文件名
2. 避免使用特殊字符
3. 系统会自动处理文件名编码

### Q5: 后端报错 "系统异常"？

**A:** 当前使用前端本地导出，不依赖后端接口。如果看到此错误：
1. 刷新页面重试
2. 检查浏览器控制台日志
3. 联系技术支持

---

## 🔄 升级到后端导出

当后端接口实现后，可以无缝切换：

### 切换步骤

1. **后端实现接口** - 按照 `BACKEND_EXPORT_API_SPEC.md` 规范
2. **修改配置** - 在 `CaseDetail.vue` 中切换导出方法
3. **测试验证** - 确保导出功能正常
4. **部署上线** - 发布新版本

### 切换代码示例

```javascript
// 当前：前端本地导出
const result = exportTestCaseLocal(props.testCase, format, options)

// 升级后：后端API导出
const response = await exportTestCase(caseId, format, options)
```

---

## 📚 相关文档

- **后端接口规范：** `BACKEND_EXPORT_API_SPEC.md`
- **功能说明文档：** `TEST_CASE_EXPORT_FEATURE.md`
- **数据字段映射：** 见 `BACKEND_EXPORT_API_SPEC.md` 第3节

---

## 🆘 技术支持

如遇到问题，请提供以下信息：

1. **浏览器版本**
2. **操作系统**
3. **导出格式**
4. **错误截图**
5. **浏览器控制台日志**

---

## ✨ 特性预告

即将支持的功能：

- [ ] 批量导出多个测试用例
- [ ] 导出为PDF格式
- [ ] 导出模板自定义
- [ ] 导出历史记录
- [ ] 定时自动导出
- [ ] 导出到云存储

---

**最后更新：** 2025-10-23  
**版本：** 1.0.0

